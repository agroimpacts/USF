---
title: "san_francisco"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{san_francisco}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(USF)
library(sf)
library(tidyverse)
library(tmap)
```

### Assessors data
```{r}
sf_ass_data <- read.csv("~/Clark/RA-ing/SummerInstitute/GIS/sanfran/Assessor_Historical_Secured_Property_Tax_Rolls.csv") 
parcels <- st_read("~/Clark/RA-ing/SummerInstitute/GIS/sanfran/Parcels/Parcels/sanfranparcel.shp")

names(parcels)[1] <- "Parcel.Number"


unique(sf_ass_data$Closed.Roll.Year)

# for 2019

sf_ass_data2019 <- sf_ass_data %>% filter(Closed.Roll.Year == 2019) %>% filter(!Assessed.Personal.Property.Value %in% NA)

# join with parcel data

sf_2019_prop <- right_join(parcels, sf_ass_data2019, by = "Parcel.Number")

sf_2019_prop <- sf_2019_prop %>% st_as_sf()
colnames(sf_2019_prop)

sf_2019_prop <- sf_2019_prop[-c(2:11, 13:22)] #remove unwanted columns

# map parcel data for 2019
tmap_mode("view")
tm_shape(sf_2019_prop) + 
 tm_polygons("Parcel.Number", title = "Property Values 2019", style = "jenks", palette = "viridis") +
  #tm_add_legend(col = c("#1CFBA5", "#2F28FA", "#FF0023"), 
   #      labels = c("Wash. Post Data", "Fatal Encounters", 
                   # "Mapping Police Violence"), title = "Police Shootings Data")  #+
tm_basemap(server = "OpenStreetMap", alpha = 0.7) 

class(sf_2019_prop)

```

```{r}

# sf_ass_data2019 <- sf_ass_data2019 %>% group_by(Block) %>% summarise(Value = mean(Assessed.Land.Value))
# formatC(sf_ass_data2019$Block, width = 4, format = "d", flag = "0")
# 
# write.csv(sf_ass_data2019,
#           file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/sf_ass_data2019.csv")
# 
# # blocks2019 <- right_join(sf_ass_data2019, parcels, by = c("Block" = "block_num")) %>% st_as_sf()
# 
# # for 2009
# 
# sf_ass_data2009 <- sf_ass_data %>% filter(Closed.Roll.Year == 2009)
# sf_ass_data2009 <- sf_ass_data2009 %>% group_by(Block) %>% summarise(Value = mean(Assessed.Land.Value))
# formatC(sf_ass_data2009$Block, width = 4, format = "d", flag = "0")
# write.csv(sf_ass_data2009,
#           file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/sf_ass_data2009.csv")
# 

```


Calls service - need address locator

```{r}
sf_calls <- read.csv("~/Clark/RA-ing/SummerInstitute/GIS/sanfran/Police_Department_Calls_for_Service.csv")
```

