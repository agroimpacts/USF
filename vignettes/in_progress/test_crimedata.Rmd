---
title: "test_crimedata"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{test_crimedata}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: inline
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(USF)
library(tidyverse)
library(geospaar)
library(foreign)
```


- Baltimore, MD
- Chicago, IL
- NYC, NY
- Bay area, CA 
- Detroit, MI
- Kansas City, MO

Washington Post Data - police shootings
```{r echo=FALSE}
data(wpdata)
t_wpdata <- wpdata %>% filter(state == "MD"| state == "IL" | state == "NY" | 
                    state == "CA" | state == "MI" | state == "MO")

# write.csv(t_wpdata, 
#           file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/t_wpdata.csv")


t_wpdata$latitude[is.na(t_wpdata$latitude)] <- 0
t_wpdata$longitude[is.na(t_wpdata$longitude)] <- 0

t_wpdata_sf <- st_as_sf(t_wpdata, coords = c("longitude", "latitude"), crs = 4269)

sf_wpdata <- t_wpdata_sf %>% filter(city == "San Francisco")

ch_wpata <- t_wpdata_sf %>% filter(city == "Chicago")

more_wpdata <- t_wpdata_sf %>% filter(city == "Baltimore")

nyc_wpdata <- t_wpdata_sf %>% filter(city == "New York")

dt_wpdata <- t_wpdata_sf %>% filter(city == "Detroit")
 
kcmo_wpdata <- t_wpdata_sf %>% filter(city == "Kansas City")

```

Fatal Encounters
```{r echo=FALSE}
data(encounters)
names(encounters)[11] <- "city_death"
names(encounters)[15] <- "address"
names(encounters)[16] <- "latitude"
names(encounters)[17] <- "longitude"

t_encounters <- encounters %>% 
  filter(State == "MD"| State == "IL" | State == "NY" | State == "CA" | 
           State == "MI" | State == "MO")

write.csv(t_encounters, 
          file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/t_encounters.csv")



t_encounters$latitude[is.na(t_encounters$latitude)] <- 0
t_encounters$longitude[is.na(t_encounters$longitude)] <- 0

t_encounters_sf <- st_as_sf(t_encounters, 
                            coords = c("longitude", "latitude"), crs = 4269)

write.csv(t_encounters, 
          file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/t_encounters.csv")

sf_encounters <- t_encounters_sf %>% filter(city_death == "San Francisco")

ch_encounters <- t_encounters_sf %>% filter(city_death == "Chicago")

more_encounters <- t_encounters_sf %>% filter(city_death == "Baltimore")

nyc_encounters <- t_encounters_sf %>% filter(city_death == "New York")

dt_encounters <- t_encounters_sf %>% filter(city_death == "Detroit")
 
kcmo_encounters <- t_encounters_sf %>% filter(city_death == "Kansas City")

```

Mapping Police Violence
Worksheet 1 "2013-2020 Police Killings"
```{r echo=FALSE}

# Use address

data(mpv_polkill)
names(mpv_polkill)[7] <- "address"

t_mpv_polkill <- mpv_polkill %>% 
  filter(State == "MD"| State == "IL" | State == "NY" | State == "CA" | 
           State == "MI" | State == "MO")

write.csv(t_mpv_polkill,
          file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/t_mpv_polkill.csv")

write.xlsx(x, file, sheetName = "Sheet1", 
  col.names = TRUE, row.names = TRUE, append = FALSE)


sf_mpv_polkill <- t_mpv_polkill %>% filter(City == "San Francisco")

ch_mpv_polkill <- t_mpv_polkill %>% filter(City == "Chicago")

more_mpv_polkill <- t_mpv_polkill %>% filter(City == "Baltimore")

nyc_mpv_polkill <- t_mpv_polkill %>% filter(City == "New York")

dt_mpv_polkill <- t_mpv_polkill %>% filter(City == "Detroit")
 
kcmo_mpv_polkill <- t_mpv_polkill %>% filter(City == "Kansas City")

```

Worksheet 2 "2013-2020 Killings by PD"
```{r echo=FALSE}
# Chart by city, breakdown by population

data(mpv_killbypd)
colnames(mpv_killbypd)

t_mpv_killbypd <- mpv_killbypd %>% 
  filter(State == "Maryland"| State == "Illinoins" | State == "New York" | State == "California" | 
           State == "Michigan" | State == "Missurri")

# write.csv(t_mpv_killbypd,
#           file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/t_mpv_killbypd.csv")

sf_mpv_killbypd <- t_mpv_killbypd %>% filter(City == "San Francisco")

ch_mpv_killbypd <- t_mpv_killbypd %>% filter(City == "Chicago")

more_mpv_killbypd <- t_mpv_killbypd %>% filter(City == "Baltimore")

nyc_mpv_killbypd <- t_mpv_killbypd %>% filter(City == "New York")

dt_mpv_killbypd <- t_mpv_killbypd %>% filter(City == "Detroit")
 
kcmo_mpv_killbypd <- t_mpv_killbypd %>% filter(City == "Kansas City")

colnames(t_mpv_killbypd)

```

Worksheet 3 "2013-2020 Killings by State"
```{r echo=FALSE}
# Chart State by specifics
data(mpv_killbystate)

t_mpv_killbystate <- mpv_killbystate %>% 
  filter(State == "MD"| State == "IL" | State == "NY" | State == "CA" | 
           State == "MI" | State == "MO")

# write.csv(t_mpv_killbypd, 
#           file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/t_mpv_killbystate.csv")

```

Worksheet 4 "Police Killings of Black Men"
Chart by City: only for Chicago and Kansas City

```{r echo=FALSE}

data(mpv_polkilbm)
colnames(mpv_polkilbm)

t_mpv_polkilbm <- mpv_polkilbm %>% 
  filter(City == "Baltimore"| City == "Chicago" | City == "New York City" | City == "San Francisco" | 
           City == "Detroit" | City == "Kansas City Missouri")

# write.csv(t_mpv_polkilbm, 
#           file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/t_mpv_polkilbm.csv")


```

### Stops - Open Policing Stanford

```{r echo=FALSE}

library(readr)
setwd("~/Clark/RA-ing/SummerInstitute/openpolincingstanford")

# San Francisco
sf_ops <- readRDS("~/Clark/RA-ing/SummerInstitute/openpolincingstanford/san_francisco_2020_04_01.rds")

sf_ops$lat[is.na(sf_ops$lat)] <- 0
sf_ops$lng[is.na(sf_ops$lng)] <- 0

sf_ops_sf <- st_as_sf(sf_ops, 
                            coords = c("lng", "lat"), crs = 4269)

write.csv(sf_ops_sf,
          file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/sf_ops_sf.csv")


# Chicago
ch_ops <- readRDS("~/Clark/RA-ing/SummerInstitute/openpolincingstanford/chicago_2020_04_01.rds")

ch_ops$lat[is.na(ch_ops$lat)] <- 0
ch_ops$lng[is.na(ch_ops$lng)] <- 0

ch_ops_sf <- st_as_sf(ch_ops, 
                            coords = c("lng", "lat"), crs = 4269)


# Baltimore
# use beat or district to spatialize
more_ops <- read.csv("~/Clark/RA-ing/SummerInstitute/openpolincingstanford/md_baltimore_2020_04_01.csv")
```


### ACLUM DD1033 Program

```{r}
# Chart by state

library(readxl)
setwd("~/Clark/RA-ing/SummerInstitute/ACLUM-Public-Datasets")
excel_sheets("Department of Defense 1033 Program/DISP_AllStatesAndTerritories.xlsx")

# San Francisco
dd1033_CA <- read_excel("Department of Defense 1033 Program/DISP_AllStatesAndTerritories.xlsx",
                          sheet = "California")
names(dd1033_CA)[2] <- "Station"

sf_dd1033_CA <- dd1033_CA[grep("^SAN FRANCISCO", dd1033_CA$Station), ]

# Chicago
dd1033_IL <- read_excel("Department of Defense 1033 Program/DISP_AllStatesAndTerritories.xlsx",
                          sheet = "Illinois")
names(dd1033_IL)[2] <- "Station"
sf_dd1033_IL <- dd1033_IL[grep("^CHICAGO", dd1033_IL$Station), ]


# Baltimore
dd1033_MD <- read_excel("Department of Defense 1033 Program/DISP_AllStatesAndTerritories.xlsx",
                          sheet = "Maryland")
names(dd1033_MD)[2] <- "Station"
sf_dd1033_MD <- dd1033_MD[grep("^BALTIMORE", dd1033_MD$Station), ]

# New York
dd1033_NY <- read_excel("Department of Defense 1033 Program/DISP_AllStatesAndTerritories.xlsx",
                          sheet = "New York")
names(dd1033_NY)[2] <- "Station"
sf_dd1033_NY <- dd1033_NY[grep("^NEW YORK", dd1033_NY$Station), ]

# Detroit
dd1033_MI <- read_excel("Department of Defense 1033 Program/DISP_AllStatesAndTerritories.xlsx",
                          sheet = "Michigan")
names(dd1033_MI)[2] <- "Station"

sf_dd1033_MI <- dd1033_MI[grep("^DETROIT", dd1033_MI$Station), ]

# Kansas City
dd1033_MO <- read_excel("Department of Defense 1033 Program/DISP_AllStatesAndTerritories.xlsx",
                          sheet = "Missourri")
names(dd1033_MO)[2] <- "Station"

sf_dd1033_MO <- dd1033_MO[grep("^KANSAS", dd1033_MO$Station), ]


```


```{r}
setwd("~/Clark/RA-ing/SummerInstitute/NYPDMCDU")
nyc_complaints <- read.csv("CCRB Complaint Database Raw 04.20.2021.csv")

nyc_complaints <- nyc_complaints %>% 
  separate(IncidentPrecinct, into = c("PCT", "Precinct"), sep = " ")

nyc_complaints$Precinct <- str_remove(nyc_complaints$Precinct, "^0+") 
nyc_complaints$Precinct <- as.numeric(nyc_complaints$Precinct)


sum_complaints <- nyc_complaints %>% group_by(Precinct) %>% count()

write.csv(sum_complaints,
          file = "~/Clark/RA-ing/SummerInstitute/USF/inst/data/nyc_complaints.csv")

precinct <- st_read("~/Clark/RA-ing/SummerInstitute/GIS/nyc/Police Precincts/geo_export_a5aeebd8-107a-4da7-b33a-095cfe0d6db1.shp")

sf_complaints <- right_join(sum_complaints, precinct, by = c("Precinct" = "precinct"))

plot(sf_complaints$geometry)
```

```{r}
acs_nyc <- read.csv("~/Clark/RA-ing/SummerInstitute/GIS/nyc/ACS/")
```



